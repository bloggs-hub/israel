### Описание

В этом архиве находится клиент для работы с АПИ сервиса клоаки.

На каждый запрос станицы клиентский код, собирает информацию для запроса и отправлет ее в АПИ сервис клоаки для анализа, в ответ сервис
возвращает тип страницу которую нужно показать посетителю. Все настройки потока можно менять в Личном кабинете клоаки и они моментально применяются без перезагрузки кода.

Помимо этого клиент умеет анализировать качество приходящего трафика и отправляет статистическую информацию на сервер. Все параметры вы можете посмотреть в личном кабинете.

Лить трафик можно двумя способами:

1. Слать напрямую на index.php. В этом случае клиент обработает запрос и в ответе отрисует white или black страницу.

2. Слать на свою белую html страницу в которой будет включен скрипт. Скрипт отправит запрос на анализ и в случает необходимости показать black страницу - полностью заменит вашу white



### Базовая настройка

1. Загрузить файлы index.php и .htaccess по FTP в корень вашего домена.

*** Файл .htaccess может быть не виден, тогда вам нужно активировать опцию "Показывать скрытые файлы и папки" в вашей операционной системе. ***

2. Создать и загрузить на FTP white и black  страницы. Например w.html, b.html  или  w.php, b.php.
Этот шаг можно пропустить, если вы в настройках потока будите указывать ссылки на white/black  страница с других сайтов.

3. Создать в клоаке новый поток и прописать для него:
    - хост (домен) на который вы залили index.php
    - white page, например w.html или http://someothersite.info/white.php
    - black page, например b.html или http://someothersite.info/black.php
    - другие настройки потока

4. Проверить работу. Откройте в браузере http://MY_DOMAIN.TUT/index.php и вы должны увидеть либо white, либо black page в зависимости от настроек вашего потока.

5. Проверьте отображение статистики по потоку в Личном кабинете

6. Ваш домен готов к клоакингу в режиме прямого слива.



### Настройка интеграции через JavaScript

Вы можете интегрировать ваш скрипт клоакинга в любую html страницу на любом домене. В том числе в сервисы на подобии tilda.

1. Произведите базовую настройку.

2. Создайте white страницу на любом домене.

3. Добавьть между тэгами <head></head> следующу строку:

    <script src="http://[ВАШ ДОМЕН]/livestatistics.js"></script>

    [ВАШ ДОМЕН] - домен на котором была произведена базовая настройка скрипта клоакинга

    livestatistics.js - любое название файла, которого не существует на сервере, главное что бы расширение было .js

    С помощью .htaccess запрос будет перенаправлен на index.php файл и активирован режим интеграции с Javascript

4. Создайте в клоаке новый поток и пропишите для него:
       - хост (домен) на котором вы создали свою white страницу
       - black page, например b.html относительно домена на котором произведена базовая настройка или http://someothersite.info/black.php
       - другие настройки потока

5. Зайдите на вашу white page, в случае если ваш запрос удовлетворяет критериям black page, код вашей страницы должен быть заменен нв black

5. Проверьте отображение статистики по потоку в Личном кабинете

6. Ваш домен готов к клоакингу в режиме интеграции JavaScript

К домену на котором произведена Базовая настройка может быть подключено неограниченной количество интеграций JavaScript.



#### Проблемы и способы их устранения

1. После базовой настройки скрипт index.php не работает.
    - Проверьте правильно ли прописан хост в потоке.
    - Проверьте активирован ли поток
    - Проверьте правильно ли прописаны white и black страница и существуют ли они на сервере, если прописаны относительный пути.

2. В режиме интеграции JavaScript  black pagе не показывается

    - Проверьте правильно ли прописан хост в потоке. Он должен соответствовать тому домену на котором создана white page
    - Проверьте активирован ли поток
    - Проверьте правильно пли прописан black page
    - Удостоверится что ваш тестовый запрос удовлетворят критерим пока black

3. http://[ВАШ ДОМЕН]/livestatistics.js  возвращает ошибку 404
     - на хостинге работает веб сервер nginx вместо apache
     - не работает rewrite из файла .htaccess, не доступно на вашем хостинге

     Вы можете попробовать решить указанные проблемы либо заменить строку на:

     http://[ВАШ ДОМЕН]/index.php?js или http://[ВАШ ДОМЕН]/?js
